package com.poc.banking.AccountService.controller;

import java.net.URI;
import java.net.URISyntaxException;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

import com.poc.banking.AccountService.entity.Account;
import com.poc.banking.AccountService.entity.UserDetails;
import com.poc.banking.AccountService.response.AddAccount;
import com.poc.banking.AccountService.response.BaseResponse;
import com.poc.banking.AccountService.response.ValidateUserResponse;
import com.poc.banking.AccountService.service.ManageAccountService;

@RestController
@RequestMapping(name= "api/account")
public class MainController {
	
	@Autowired
	ManageAccountService manageAccountService;

	@RequestMapping(name= "/addaccount")
	AddAccount addAccount(Account account) {
		AddAccount addAccount = new AddAccount();
		ValidateUserResponse response = this.isValidUser(account.getUserDetails());
		if (response.isValidUser()) {
			setUserDetials(response,account);
			addAccount = manageAccountService.addAccount(account);
		}
		else {
			addAccount.setResponseCode("310");
			addAccount.setMessage("User id is not exists");
		}
		return addAccount;
	}
	
	private ValidateUserResponse isValidUser(UserDetails user)  {
		RestTemplate restTemplate	=  new RestTemplate();
		try {
			URI uri =  new URI("http://localhost:8082/api/validateUser");
			
		return restTemplate.postForObject(uri,user , ValidateUserResponse.class);
		//System.out.println("@Ramesh" + response.getMessage());

		} catch (URISyntaxException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return null;
		
	}
	
	
	void setUserDetials(ValidateUserResponse response,Account account) {
		if (response.isValidUser()) {
			account.setUserDetails(response.getUserDetails());
		}
	}
}
